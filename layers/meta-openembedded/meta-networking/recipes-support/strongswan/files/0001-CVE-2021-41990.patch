From 862bd21aaef77760b9bd2375a36815f3e5e8c994 Mon Sep 17 00:00:00 2001
From: Siddharth Doshi <sdoshi@mvista.com>
Date: Wed, 20 Oct 2021 11:32:09 +0000
Subject: [PATCH 1/2] CVE-2021-41990

Upstream-Status:https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/strongswan/5.9.1-1ubuntu3.1/strongswan_5.9.1-1ubuntu3.1.debian.tar.xz

Signed-off-by: Siddharth Doshi <sdoshi@mvista.com>
---
 src/libstrongswan/credentials/keys/signature_params.c | 6 +++++-
 src/libstrongswan/plugins/gmp/gmp_rsa_public_key.c    | 2 +-
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/src/libstrongswan/credentials/keys/signature_params.c b/src/libstrongswan/credentials/keys/signature_params.c
index d89bd2c..837de84 100644
--- a/src/libstrongswan/credentials/keys/signature_params.c
+++ b/src/libstrongswan/credentials/keys/signature_params.c
@@ -322,7 +322,11 @@ bool rsa_pss_params_parse(chunk_t asn1, int level0, rsa_pss_params_t *params)
 			case RSASSA_PSS_PARAMS_SALT_LEN:
 				if (object.len)
 				{
-					params->salt_len = (size_t)asn1_parse_integer_uint64(object);
+					params->salt_len = (ssize_t)asn1_parse_integer_uint64(object);
+					if (params->salt_len < 0)
+					{
+						goto end;
+					}
 				}
 				break;
 			case RSASSA_PSS_PARAMS_TRAILER:
diff --git a/src/libstrongswan/plugins/gmp/gmp_rsa_public_key.c b/src/libstrongswan/plugins/gmp/gmp_rsa_public_key.c
index f9bd1d3..3a77509 100644
--- a/src/libstrongswan/plugins/gmp/gmp_rsa_public_key.c
+++ b/src/libstrongswan/plugins/gmp/gmp_rsa_public_key.c
@@ -168,7 +168,7 @@ static bool verify_emsa_pss_signature(private_gmp_rsa_public_key_t *this,
 	int i;
 	bool success = FALSE;
 
-	if (!params)
+	if (!params || params->salt_len < 0)
 	{
 		return FALSE;
 	}
-- 
2.24.3

