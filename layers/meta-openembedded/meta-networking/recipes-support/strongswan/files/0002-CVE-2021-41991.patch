From d188e98961a0bf62529f51254852bc5b145e1af1 Mon Sep 17 00:00:00 2001
From: Siddharth Doshi <sdoshi@mvista.com>
Date: Wed, 20 Oct 2021 11:37:19 +0000
Subject: [PATCH 2/2] CVE-2021-41991

Upstream-Status: https://launchpad.net/ubuntu/+archive/primary/+sourcefiles/strongswan/5.9.1-1ubuntu3.1/strongswan_5.9.1-1ubuntu3.1.debian.tar.xz

Signed-off-by: Siddharth Doshi <sdoshi@mvista.com>
---
 src/libstrongswan/credentials/sets/cert_cache.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/libstrongswan/credentials/sets/cert_cache.c b/src/libstrongswan/credentials/sets/cert_cache.c
index f1579c6..ceebb38 100644
--- a/src/libstrongswan/credentials/sets/cert_cache.c
+++ b/src/libstrongswan/credentials/sets/cert_cache.c
@@ -151,7 +151,7 @@ static void cache(private_cert_cache_t *this,
 	for (try = 0; try < REPLACE_TRIES; try++)
 	{
 		/* replace a random relation */
-		offset = random();
+		offset = random() % CACHE_SIZE;
 		for (i = 0; i < CACHE_SIZE; i++)
 		{
 			rel = &this->relations[(i + offset) % CACHE_SIZE];
-- 
2.24.3

